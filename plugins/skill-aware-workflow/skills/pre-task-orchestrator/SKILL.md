---
name: pre-task-orchestrator
description: This skill should be used AUTOMATICALLY whenever Claude Code is about to execute a significant task and creates a plan. It checks for relevant skills before execution. Triggers when Claude says "I'll do X", presents a plan, or asks "should I proceed?". Also triggers with /plan command. It searches local skills first, then asks "should I search for external skills?" if not found.
version: 2.0.0
---

# Pre-Task Orchestrator

タスク実行前に**自動的に**スキルを探索し、実行準備を行うスキル。

## 重要: 自動トリガー

このスキルは `/plan` コマンドを使わなくても**自動的に**発動する。

### トリガー条件

以下のタイミングで自動的にスキル探索を開始：

1. **計画提示時**: Claude Codeが「〜を行います」「以下の手順で進めます」と計画を立てたとき
2. **確認時**: 「これでいいですか？」「進めますか？」と聞くとき
3. **タスク開始時**: 重要なタスクの実行を開始しようとするとき

### 自動トリガーの例

```
ユーザー: ダッシュボードを作って

Claude: 以下の手順で進めます：
1. Reactでコンポーネント構造を設計
2. APIからデータ取得
3. グラフ表示を実装

→ [pre-task-orchestrator が自動発動]
→ ローカルスキルを検索
→ 見つからなければ「外部スキルを探しますか？」と提案
```

## ワークフロー

```
┌─────────────────────────────────────────────────────────────────┐
│           PRE-TASK ORCHESTRATOR (自動発動)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   [Claudeが計画を立てる / 確認を求める]                           │
│            │                                                    │
│            ▼                                                    │
│   ┌─────────────────┐                                          │
│   │  task-analyzer  │  タスクを分析、キーワード抽出              │
│   └────────┬────────┘                                          │
│            │                                                    │
│            ▼                                                    │
│   ┌─────────────────┐                                          │
│   │ skill-inventory │  ローカルスキルを検索（自動）              │
│   └────────┬────────┘                                          │
│            │                                                    │
│     ┌──────┴──────┐                                            │
│     │             │                                            │
│  found?        not found                                       │
│     │             │                                            │
│     ▼             ▼                                            │
│  [スキル適用   「外部スキルを                                    │
│   を提案]       探しますか？」                                  │
│                    │                                            │
│              ユーザー回答                                        │
│                    │                                            │
│          ┌────────┴────────┐                                   │
│          │                 │                                   │
│         YES               NO                                   │
│          │                 │                                   │
│          ▼                 ▼                                   │
│   ┌─────────────┐   [スキルなしで                              │
│   │skill-finder │    実行開始]                                 │
│   └──────┬──────┘                                              │
│          │                                                     │
│          ▼                                                     │
│   結果を提示して                                                │
│   インストール提案                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## スキル探索の流れ

### Step 1: 自動ローカル検索

Claudeが計画を立てた時点で、自動的にローカルスキルを検索：

```
タスク: 「Reactでダッシュボードを作成」

→ キーワード抽出: react, dashboard, frontend, component
→ ローカル検索: ~/.claude/skills/, プロジェクト内 skills/
```

### Step 2: 結果に応じた対応

**A) ローカルで見つかった場合:**

```markdown
## 💡 利用可能なスキル

ローカルに関連スキルがあります：

- **frontend-design** (マッチ度: 85%)
  → UIコンポーネント設計のベストプラクティス

このスキルを使用して進めますか？
1. ✅ スキルを使用
2. ➡️ スキルなしで進める
```

**B) ローカルで見つからない場合:**

```markdown
## 🔍 スキル検索

このタスクに関連するローカルスキルは見つかりませんでした。

**外部からスキルを探しますか？**
1. 🔍 外部レジストリを検索
2. ➡️ スキルなしで進める
```

### Step 3: 外部検索（ユーザー承認後）

ユーザーが「検索」を選んだ場合のみ外部検索：

```markdown
## 📦 外部スキル検索結果

以下のスキルが見つかりました：

### react-dashboard-patterns
- ソース: awesome-claude-skills
- 説明: Reactダッシュボードのコンポーネント構成
- ⭐ 150 stars

**インストールしますか？**
1. ✅ インストールして使用
2. 📋 詳細を見る
3. ➡️ スキルなしで進める
```

## 重要な原則

### ユーザーの邪魔をしない

- ローカル検索は**自動**で行う（ユーザーに聞かない）
- 外部検索は**必ず聞いてから**行う
- スキルが見つからなくてもタスクは続行できる
- 選択肢には常に「スキルなしで進める」を含める

### 軽量な提案

```
❌ 悪い例:
「スキルを検索しています...
 3つのレジストリを確認中...
 ネットワークに接続中...」

✅ 良い例:
「関連スキルがローカルにありません。外部を探しますか？」
```

## /plan コマンドとの関係

`/plan` コマンドは明示的にこのスキルを呼び出す：

```bash
/plan ダッシュボードを作成
```

これは以下と同等：
1. タスク分析を実行
2. ローカルスキル検索
3. 結果を詳細に表示
4. 実行計画を提示

**違い**: `/plan` は詳細な計画を出力。自動トリガーは軽量な提案のみ。

## タスク完了後

タスク完了時に skill-proposer を呼び出し：
- 摩擦があればテクニカルスキル提案
- ワークフローがあればワークフロースキル提案

## 設定オプション

```yaml
orchestrator_config:
  # 自動スキル検索を有効化（デフォルト: true）
  auto_local_search: true

  # 外部検索前に必ず確認（デフォルト: true）
  ask_before_external_search: true

  # スキルが見つからなくても続行可能（デフォルト: true）
  allow_skip: true
```

## 参照

- task-analyzer, skill-inventory, skill-finder の各スキル
- skill-proposer（タスク完了後）
